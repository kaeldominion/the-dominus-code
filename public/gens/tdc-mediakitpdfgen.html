import React, { useState, useEffect, useRef } from 'react';
import { Upload, Download, Type, Image as ImageIcon, Check, Crown, LayoutTemplate, Users, Zap, Globe, Flame } from 'lucide-react';

const DominusGenerator = () => {
  // State for Images
  const [coverImage, setCoverImage] = useState(null);
  const [headshot, setHeadshot] = useState(null);
  const [icon, setIcon] = useState(null);
  
  // State for Text Content
  const [content, setContent] = useState({
    title: "DOMINUS CODE",
    subtitle: "F*CK MONOGAMY. BUILD A DYNASTY.",
    author: "SPENCER TARRING",
    bio: "Spencer Tarring is a builder. He has lived the extremes of the modern male arch: from the high-speed excess of Shanghai's VIP nightlife to the disciplined sovereignty of his Bali compound. He is not a guru. He is an operator.",
    website: "www.thedominuscode.com",
    insta: "@spencertarringx",
    email: "media@thedominuscode.com"
  });

  const [isGenerating, setIsGenerating] = useState(false);
  const printRef = useRef(null);

  // Load html2pdf library and Fonts
  useEffect(() => {
    // Load Library
    const script = document.createElement('script');
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js";
    script.async = true;
    document.body.appendChild(script);

    // Load Fonts
    const link = document.createElement('link');
    link.href = "https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Montserrat:wght@300;400&display=swap";
    link.rel = "stylesheet";
    document.head.appendChild(link);

    return () => {
      document.body.removeChild(script);
      document.head.removeChild(link);
    };
  }, []);

  // Handlers
  const handleImageUpload = (e, setter) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => setter(e.target.result);
      reader.readAsDataURL(file);
    }
  };

  const handleGeneratePDF = () => {
    if (!window.html2pdf) return;
    setIsGenerating(true);
    
    const element = printRef.current;
    const opt = {
      margin: 0,
      filename: 'Dominus_Media_Kit.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    window.html2pdf().set(opt).from(element).save().then(() => setIsGenerating(false));
  };

  return (
    <div className="min-h-screen bg-neutral-900 text-gray-100 flex flex-col md:flex-row font-['Montserrat'] font-light">
      
      {/* --- LEFT SIDEBAR: CONTROLS --- */}
      <div className="w-full md:w-1/3 lg:w-1/4 bg-black border-r border-neutral-800 p-6 overflow-y-auto h-screen sticky top-0 z-10">
        <div className="mb-8 flex items-center space-x-2">
          <Crown className="text-[#C5A059] w-6 h-6" />
          <h1 className="text-xl font-bold tracking-[0.2em] text-[#C5A059] uppercase font-['Cinzel']">Dominus Engine</h1>
        </div>

        <div className="space-y-8">
          
          {/* Image Uploads */}
          <section>
            <h3 className="text-[10px] font-bold text-neutral-500 uppercase tracking-[0.2em] mb-4 flex items-center font-['Montserrat']">
              <ImageIcon className="w-3 h-3 mr-2" /> Visual Assets
            </h3>
            
            <div className="space-y-4">
              <UploadButton 
                label="Book Cover" 
                onChange={(e) => handleImageUpload(e, setCoverImage)} 
                isUploaded={!!coverImage} 
              />
              <UploadButton 
                label="Headshot" 
                onChange={(e) => handleImageUpload(e, setHeadshot)} 
                isUploaded={!!headshot} 
              />
              <UploadButton 
                label="Brand Icon" 
                onChange={(e) => handleImageUpload(e, setIcon)} 
                isUploaded={!!icon} 
              />
            </div>
          </section>

          {/* Text Edits */}
          <section>
            <h3 className="text-[10px] font-bold text-neutral-500 uppercase tracking-[0.2em] mb-4 flex items-center font-['Montserrat']">
              <Type className="w-3 h-3 mr-2" /> Core Data
            </h3>
            <div className="space-y-3 font-['Montserrat']">
              <input 
                value={content.title}
                onChange={(e) => setContent({...content, title: e.target.value})}
                className="w-full bg-neutral-900 border border-neutral-700 p-2 text-xs uppercase tracking-widest focus:border-[#C5A059] outline-none text-white placeholder-neutral-600"
                placeholder="Title"
              />
              <input 
                value={content.subtitle}
                onChange={(e) => setContent({...content, subtitle: e.target.value})}
                className="w-full bg-neutral-900 border border-neutral-700 p-2 text-xs focus:border-[#C5A059] outline-none text-white placeholder-neutral-600"
                placeholder="Subtitle"
              />
              <textarea 
                value={content.bio}
                onChange={(e) => setContent({...content, bio: e.target.value})}
                className="w-full bg-neutral-900 border border-neutral-700 p-2 text-xs focus:border-[#C5A059] outline-none text-white placeholder-neutral-600 h-32 leading-relaxed"
                placeholder="Bio"
              />
            </div>
          </section>

          {/* Action */}
          <div className="pt-4 border-t border-neutral-800">
            <button 
              onClick={handleGeneratePDF}
              disabled={isGenerating}
              className={`w-full flex items-center justify-center space-x-2 py-4 text-xs font-bold uppercase tracking-[0.2em] transition-all duration-200 font-['Montserrat']
                ${isGenerating ? 'bg-neutral-800 text-neutral-500' : 'bg-[#C5A059] text-black hover:bg-white'}`}
            >
              <Download className="w-4 h-4" />
              <span>{isGenerating ? 'Forging...' : 'Export PDF'}</span>
            </button>
          </div>

        </div>
      </div>

      {/* --- RIGHT SIDE: PREVIEW CANVAS --- */}
      <div className="flex-1 bg-neutral-800 p-8 overflow-y-auto flex justify-center items-start">
        
        {/* THE DOCUMENT CONTAINER (TARGET FOR PDF) */}
        <div ref={printRef} className="w-[210mm] bg-white text-black shadow-2xl origin-top transform scale-75 md:scale-100 transition-transform">
          
          {/* --- PAGE 1 --- */}
          <div className="relative w-full h-[297mm] p-12 flex flex-col justify-between overflow-hidden">
            
            {/* Watermark */}
            {icon && (
              <div className="absolute inset-0 flex items-center justify-center opacity-[0.05] pointer-events-none z-0">
                <img src={icon} alt="" className="w-1/2" />
              </div>
            )}

            {/* Header */}
            <div className="relative z-10 text-center mt-12">
              {icon && <img src={icon} alt="" className="w-16 h-16 mx-auto mb-6 opacity-80" />}
              
              <div className="mb-4 font-['Cinzel'] text-gray-900">
                <span className="block text-xl font-bold tracking-[0.2em] mb-2">THE</span>
                <h1 className="text-6xl font-extrabold tracking-[0.05em] uppercase leading-none">{content.title}</h1>
              </div>
              
              <p className="text-2xl uppercase text-[#C5A059] font-semibold tracking-wide font-['Cormorant_Garamond']">{content.subtitle}</p>
            </div>

            {/* Book Cover */}
            <div className="relative z-10 flex-1 flex items-center justify-center my-8">
              {coverImage ? (
                <img src={coverImage} alt="Book Cover" className="h-[400px] shadow-2xl object-contain" />
              ) : (
                <div className="h-[400px] w-[260px] border-2 border-dashed border-gray-300 flex items-center justify-center bg-gray-50 text-gray-400 uppercase tracking-[0.2em] text-[10px] font-['Montserrat'] font-light">
                  Upload Cover
                </div>
              )}
            </div>

            {/* Footer / Author */}
            <div className="relative z-10 text-center mb-16">
              <h2 className="text-xl font-bold tracking-[0.1em] mb-3 uppercase text-gray-900 font-['Cinzel']">By {content.author}</h2>
              <p className="text-xl text-gray-600 italic font-['Cormorant_Garamond']">"The world doesn't need more happy men. It needs strong ones."</p>
            </div>

            <div className="absolute bottom-6 left-0 w-full text-center text-[10px] text-gray-400 uppercase tracking-[0.2em] font-['Montserrat'] font-light">
              Published by SIXA Group
            </div>
          </div>

          {/* --- PAGE BREAK (For visual clarity in preview, though PDF handles auto) --- */}
          
          {/* --- PAGE 2 --- */}
          <div className="relative w-full h-[297mm] p-16 flex flex-col bg-white border-t-2 border-dashed border-gray-200">
            
             {/* Small Top Right Icon */}
             {icon && (
              <div className="absolute top-12 right-12 z-20">
                <img src={icon} alt="" className="w-8 h-8 object-contain opacity-80" />
              </div>
            )}

             {/* Watermark */}
             {icon && (
              <div className="absolute inset-0 flex items-center justify-center opacity-[0.05] pointer-events-none z-0">
                <img src={icon} alt="" className="w-1/2" />
              </div>
            )}

            <div className="relative z-10 h-full flex flex-col">
              
              {/* Section: The Book */}
              <div className="mb-12">
                <h3 className="text-xl font-bold uppercase tracking-[0.05em] border-b-2 border-black pb-2 mb-6 font-['Cinzel']">The Book</h3>
                <p className="text-lg leading-relaxed text-gray-800 mb-6 font-['Cormorant_Garamond']">
                  <span className="font-bold">The Dominus Code</span> is not a self-help book. It is a declaration of war against the mediocrity of the modern male experience. This manifesto dismantles the "Great Softening" of Western men, arguing that modernity has tricked men into trading sovereignty for comfort.
                </p>
                
                <div className="grid grid-cols-2 gap-8 mt-8">
                  <ThemeItem icon={Users} title="Fuck Monogamy" desc="Why the 'Tribe' model is the only way to secure true legacy." />
                  <ThemeItem icon={Zap} title="Polarity is Nature" desc="Reclaiming the dynamic where masculine leads and feminine follows." />
                  <ThemeItem icon={Globe} title="Sovereign Individual" desc="Escaping the 'Serfdom' of failing nation-states." />
                  <ThemeItem icon={Flame} title="Father is Fire" desc="A father must be the axis of the home, a source of order." />
                </div>
              </div>

              {/* Section: The Author */}
              <div className="mb-12 flex flex-row items-start space-x-10">
                <div className="flex-1">
                  <h3 className="text-xl font-bold uppercase tracking-[0.05em] border-b-2 border-black pb-2 mb-6 font-['Cinzel']">The Author</h3>
                  <p className="text-lg leading-relaxed text-gray-800 font-['Cormorant_Garamond']">
                    {content.bio}
                  </p>
                  <div className="mt-6 flex flex-col space-y-1 text-[10px] font-bold text-gray-600 uppercase tracking-[0.1em] font-['Montserrat'] font-light">
                    <span>Tech Entrepreneur (Ex-Dedipower)</span>
                    <span>Music Director (Ex-M1NT Shanghai)</span>
                    <span>Infrastructure Builder (Africa/Bali)</span>
                  </div>
                </div>
                <div className="w-40 h-40 flex-shrink-0 bg-gray-100 overflow-hidden">
                   {headshot ? (
                    <img src={headshot} alt="Spencer" className="w-full h-full object-cover grayscale contrast-125" />
                   ) : (
                    <div className="w-full h-full flex items-center justify-center text-[10px] text-gray-400 text-center p-2 uppercase border border-dashed border-gray-300 tracking-widest font-['Montserrat']">
                      Upload Headshot
                    </div>
                   )}
                </div>
              </div>

               {/* Section: Contact */}
               <div className="mt-auto bg-[#f8f8f8] p-8 border-l-4 border-[#C5A059]">
                 <h3 className="text-xs font-bold uppercase tracking-[0.2em] text-[#C5A059] mb-6 font-['Montserrat']">Connect & Press</h3>
                 <div className="grid grid-cols-2 gap-6 text-xs font-['Montserrat'] font-light tracking-wide">
                    <div>
                      <p className="font-bold text-gray-900 tracking-[0.1em] mb-1">WEBSITE</p>
                      <a href={`https://${content.website}`} target="_blank" rel="noopener noreferrer" className="text-gray-600 hover:text-[#C5A059] underline decoration-gray-400 underline-offset-4 transition-colors block truncate">
                        {content.website}
                      </a>
                    </div>
                    <div>
                      <p className="font-bold text-gray-900 tracking-[0.1em] mb-1">INSTAGRAM</p>
                      <a href={`https://instagram.com/${content.insta.replace('@', '')}`} target="_blank" rel="noopener noreferrer" className="text-gray-600 hover:text-[#C5A059] underline decoration-gray-400 underline-offset-4 transition-colors block truncate">
                        {content.insta}
                      </a>
                    </div>
                    <div>
                      <p className="font-bold text-gray-900 tracking-[0.1em] mb-1">INQUIRIES</p>
                      <a href={`mailto:${content.email}`} className="text-gray-600 hover:text-[#C5A059] underline decoration-gray-400 underline-offset-4 transition-colors block truncate">
                        {content.email}
                      </a>
                    </div>
                    <div>
                      <p className="font-bold text-gray-900 tracking-[0.1em] mb-1">LOCATION</p>
                      <p className="text-gray-600">Bali / Dubai / Global</p>
                    </div>
                 </div>
               </div>

               <div className="w-full text-center text-[10px] text-gray-400 uppercase tracking-[0.2em] mt-8 font-['Montserrat'] font-light">
                  Published by SIXA Group
              </div>
            
            </div>
          </div>

        </div>
      </div>
    </div>
  );
};

// UI Components

const UploadButton = ({ label, onChange, isUploaded }) => (
  <div className="relative group font-['Montserrat']">
    <input 
      type="file" 
      accept="image/*" 
      onChange={onChange} 
      className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" 
    />
    <div className={`flex items-center justify-between p-3 border text-[10px] uppercase tracking-[0.2em] transition-all duration-200
      ${isUploaded ? 'border-[#C5A059] bg-[#C5A059]/10 text-[#C5A059]' : 'border-neutral-700 bg-neutral-900 text-neutral-400 group-hover:border-neutral-500'}
    `}>
      <span className="flex items-center font-bold">
        {isUploaded ? <Check className="w-3 h-3 mr-2" /> : <Upload className="w-3 h-3 mr-2" />}
        {label}
      </span>
      {isUploaded && <span className="text-[9px] opacity-70 tracking-widest">Ready</span>}
    </div>
  </div>
);

const ThemeItem = ({ title, desc, icon: Icon }) => (
  <div className="mb-2">
    <div className="flex items-center mb-2">
      {Icon && <Icon className="w-4 h-4 text-[#C5A059] mr-2" />}
      <h4 className="text-xs font-bold text-[#C5A059] uppercase tracking-[0.05em] font-['Cinzel']">{title}</h4>
    </div>
    <p className="text-sm leading-tight text-gray-600 font-['Cormorant_Garamond']">{desc}</p>
  </div>
);

export default DominusGenerator;